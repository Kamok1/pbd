input {
  generator {
    count => 1
    lines => [
      "2024-03-15 14:23:10 [SUCCESS] ORDER-ID: {ORD-5521} | Customer: <maria.nowak@gmail.com> | Product: Laptop Dell XPS | Price: 4599.00 PLN | Category: Electronics",
      "2024-03-15 14:25:33 [SUCCESS] ORDER-ID: {ORD-5522} | Customer: <jan.kowalski@onet.pl> | Product: Klawiatura Mechaniczna | Price: 349.99 PLN | Category: Accessories",
      "2024-03-15 14:28:47 [FAILED] ORDER-ID: {ORD-5523} | Customer: <test@test.com> | Product: iPhone 15 Pro | Price: 6999.00 PLN | Category: Electronics",
      "2024-03-15 14:30:12 [SUCCESS] ORDER-ID: {ORD-5524} | Customer: <anna.wisniewska@wp.pl> | Product: Monitor 4K Samsung | Price: 1899.00 PLN | Category: Electronics",
      "2024-03-15 14:33:05 [SUCCESS] ORDER-ID: {ORD-5525} | Customer: <piotr.lewandowski@gmail.com> | Product: Mysz Logitech MX | Price: 299.00 PLN | Category: Accessories",
      "2024-03-15 14:35:21 [PENDING] ORDER-ID: {ORD-5526} | Customer: <katarzyna.z@interia.pl> | Product: Słuchawki Sony WH-1000XM5 | Price: 1499.00 PLN | Category: Audio",
      "2024-03-15 14:38:44 [SUCCESS] ORDER-ID: {ORD-5527} | Customer: <tomasz.nowicki@gmail.com> | Product: Kabel HDMI Premium | Price: 49.99 PLN | Category: Accessories",
      "2024-03-15 14:40:16 [FAILED] ORDER-ID: {ORD-5528} | Customer: <fraud@suspicious.ru> | Product: MacBook Pro M3 | Price: 12999.00 PLN | Category: Electronics",
      "2024-03-15 14:42:59 [SUCCESS] ORDER-ID: {ORD-5529} | Customer: <ewa.kowalczyk@o2.pl> | Product: Powerbank 20000mAh | Price: 129.00 PLN | Category: Accessories",
      "2024-03-15 14:45:33 [SUCCESS] ORDER-ID: {ORD-5530} | Customer: <michal.szymanski@gmail.com> | Product: Tablet Samsung Galaxy | Price: 2199.00 PLN | Category: Electronics",
      "2024-03-15 14:48:01 [CANCELLED] ORDER-ID: {ORD-5531} | Customer: <admin@test.local> | Product: Test Product | Price: 0.01 PLN | Category: Test",
      "2024-03-15 14:50:24 [SUCCESS] ORDER-ID: {ORD-5532} | Customer: <agnieszka.wojcik@interia.pl> | Product: Kamera GoPro Hero 12 | Price: 2599.00 PLN | Category: Electronics",
      "2024-03-15 14:53:17 [SUCCESS] ORDER-ID: {ORD-5533} | Customer: <robert.kaminski@wp.pl> | Product: Etui na telefon | Price: 39.99 PLN | Category: Accessories",
      "2024-03-15 14:55:40 [SUCCESS] ORDER-ID: {ORD-5534} | Customer: <barbara.kozlowska@gmail.com> | Product: Głośnik Bluetooth JBL | Price: 399.00 PLN | Category: Audio",
      "2024-03-15 14:58:12 [PENDING] ORDER-ID: {ORD-5535} | Customer: <krzysztof.jankowski@onet.pl> | Product: Router WiFi 6 | Price: 599.00 PLN | Category: Electronics",
      "2024-03-15 15:01:45 [SUCCESS] ORDER-ID: {ORD-5536} | Customer: <monika.wrobel@gmail.com> | Product: Pendrive 128GB | Price: 79.99 PLN | Category: Storage",
      "2024-03-15 15:04:20 [SUCCESS] ORDER-ID: {ORD-5537} | Customer: <pawel.olszewski@interia.pl> | Product: Dysk SSD 1TB | Price: 449.00 PLN | Category: Storage",
      "2024-03-15 15:07:03 [FAILED] ORDER-ID: {ORD-5538} | Customer: <bot_crawler@spam.com> | Product: Graphics Card RTX 4090 | Price: 15999.00 PLN | Category: Electronics",
      "2024-03-15 15:09:38 [SUCCESS] ORDER-ID: {ORD-5539} | Customer: <magdalena.pietrzak@wp.pl> | Product: Ładowarka bezprzewodowa | Price: 89.00 PLN | Category: Accessories",
      "2024-03-15 15:12:55 [SUCCESS] ORDER-ID: {ORD-5540} | Customer: <adam.grabowski@gmail.com> | Product: Mikrofon USB | Price: 249.00 PLN | Category: Audio",
      "2024-03-15 15:15:22 [SUCCESS] ORDER-ID: {ORD-5541} | Customer: <joanna.nowakowska@onet.pl> | Product: Webcam 4K Logitech | Price: 799.00 PLN | Category: Electronics",
      "2024-03-15 15:18:44 [SUCCESS] ORDER-ID: {ORD-5542} | Customer: <grzegorz.zielinski@gmail.com> | Product: Hub USB-C 7w1 | Price: 179.00 PLN | Category: Accessories",
      "2024-03-15 15:21:10 [CANCELLED] ORDER-ID: {ORD-5543} | Customer: <test.user@localhost> | Product: Sample Item | Price: 1.00 PLN | Category: Test",
      "2024-03-15 15:23:57 [SUCCESS] ORDER-ID: {ORD-5544} | Customer: <teresa.mazurek@interia.pl> | Product: Smartwatch Garmin | Price: 1299.00 PLN | Category: Electronics",
      "2024-03-15 15:26:33 [SUCCESS] ORDER-ID: {ORD-5545} | Customer: <mariusz.krawczyk@wp.pl> | Product: Kabel USB-C 2m | Price: 29.99 PLN | Category: Accessories",
      "2024-03-15 15:29:08 [SUCCESS] ORDER-ID: {ORD-5546} | Customer: <elzbieta.wojciechowska@gmail.com> | Product: Czytnik e-booków Kindle | Price: 549.00 PLN | Category: Electronics",
      "2024-03-15 15:31:45 [PENDING] ORDER-ID: {ORD-5547} | Customer: <jacek.dudek@onet.pl> | Product: Drukarka HP LaserJet | Price: 899.00 PLN | Category: Electronics",
      "2024-03-15 15:34:22 [SUCCESS] ORDER-ID: {ORD-5548} | Customer: <dorota.wieczorek@interia.pl> | Product: Tusz do drukarki | Price: 89.99 PLN | Category: Accessories",
      "2024-03-15 15:37:00 [SUCCESS] ORDER-ID: {ORD-5549} | Customer: <zbigniew.sikora@gmail.com> | Product: Skaner dokumentów | Price: 699.00 PLN | Category: Electronics",
      "2024-03-15 15:39:41 [SUCCESS] ORDER-ID: {ORD-5550} 
      | Customer: <halina.rutkowska@wp.pl> | 
      Product: Lampa biurkowa LED | Price: 149.00 PLN 
      | Category: Accessories"
    ]
  }
}
  
filter {
  grok {
    match => { "message" => "%{TIMESTAMP_ISO8601:timestamp} 
    \\[%{WORD:status}\\] ORDER-ID: \\{%{DATA:order_id}\\} \\\
     Customer: <%{DATA:customer_email}> \\| Product: %{DATA:product_name} \\| 
     Price: %{NUMBER:price:float} %{WORD:currency} \\| Category: %{GREEDYDATA:category}" }
  }
  
  date {
    match => [ "timestamp", "yyyy-MM-dd HH:mm:ss" ]
    target => "@timestamp"
    timezone => "Europe/Warsaw"
  }
  
  if [price] > 2000 {
    mutate {
      add_tag => ["HIGH_VALUE_ORDER"]
    }
  }
  
  if [status] == "FAILED" or [customer_email] =~ /test|bot|fraud|spam/ {
    mutate {
      add_tag => ["SUSPICIOUS"]
    }
  }
  
  ruby {
    code => "event.set('vat_amount', (event.get('price') * 0.23).round(2))"
  }
  
  mutate {
    remove_field => ["message", "sequence", "timestamp", "host", "@version"]
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "ecommerce-orders-%{+YYYY.MM.dd}"
  }
  stdout { codec => rubydebug }
}